---
- name: Monitor ISE Application Status
  hosts: ise
  gather_facts: no
  tasks:

    - name: Wait for SSH | {{ inventory_hostname }}
      ansible.builtin.wait_for:
        host: "{{ ansible_host }}"
        port: 22          # SSH
        sleep: 10         # Default: 1.   Seconds to sleep between checks
        timeout: 600      # Default: 300. Stop checking after <seconds>


    # ðŸ’¡ Application Server STATE may be {not running|initializing|running}
    #--------------------------------------------------------------------------
    # Example output:
    #
    # ISE PROCESS NAME                       STATE            PROCESS ID
    # ...
    # Application Server                     running          55108
    # ...
    #--------------------------------------------------------------------------

    - name: Wait for ISE Application Server 'running' | {{ inventory_hostname }}
      vars:
        ansible_command_timeout: 90 # ðŸ’¡ command requires ~40+ seconds
      ansible.netcommon.cli_command:
        command: show application status ise
      register: output
      until: output.stdout is regex('Application Server[ ]+running')
      retries: 20


    # ðŸ’¡ Any empty lines in the pause prompt will be trimmed by Ansible!
    #    The empty lines below begin with a Unicode U+2003 Em Space [â€ƒ]!
    - name: ISE Login Ready
      ansible.builtin.pause:
        seconds: 0
        prompt: |
          â€ƒ
          â€ƒ
          â€ƒ          .
          â€ƒ         /|\          ____                _       _
          â€ƒ     @  /|||\  @     |  _ \ ___  __ _  __| |_   _| |
          â€ƒ    @  /|||||\  @    | |_) / _ \/ _` |/ _` | | | | |
          â€ƒ    @  \|/ \|/  @    |  _ <  __/ (_| | (_| | |_| |_|
          â€ƒ     @.       .@     |_| \_\___|\__,_|\__,_|\__, (_)
          â€ƒ      `Y@ @ @Y`                             |___/
          â€ƒ
          â€ƒ


...